const body = document.body;
const ghost = document.getElementById('ghost-flash');

// Die Liste der "Implanted Commands"
const traumaTexts = [
    "ICH HABE ANGST",
    "ER SIEHT MICH",
    "HILF MIR",
    "VIKTOR",
    "ES IST IM RAUM",
    "ICH KANN NICHT ATMEN",
    "DREH DICH NICHT UM",
    "TE HABEO" // Ein kleiner Rest Latein für das "Ritual"
];

function triggerTrauma() {
    // Inversionseffekt für den visuellen Schock
    body.classList.add('inverted');
    setTimeout(() => {
        body.classList.remove('inverted');
    }, 100); 
    
    // Bei jedem Klick/Touch blitzt fast garantiert ein Kommando auf
    if(Math.random() > 0.4) {
        flashGhost();
    }
}

function randomGhost() {
    // Zufälliges Aufblitzen auch ohne Interaktion (alle 2-5 Sekunden)
    if(Math.random() > 0.8) {
        flashGhost();
    }
    setTimeout(randomGhost, Math.random() * 3000 + 2000);
}

function flashGhost() {
    const randomText = traumaTexts[Math.floor(Math.random() * traumaTexts.length)];
    ghost.innerText = randomText;
    
    ghost.style.display = 'block';
    // 25 Millisekunden: Das Unterbewusstsein frisst es, das Auge kann es nicht fixieren
    setTimeout(() => {
        ghost.style.display = 'none';
    }, 25); 
}

// Event-Listener für Interaktion
document.addEventListener('touchstart', triggerTrauma, {passive: true});
document.addEventListener('click', triggerTrauma);

// Starte den Zyklus
setTimeout(randomGhost, 3000);

// Rauschen-Generator (leicht rötlich, wirkt wie Blutadern auf dem Screen)
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
function noise() {
    canvas.width = window.innerWidth / 2;
    canvas.height = window.innerHeight / 2;
    let idata = ctx.createImageData(canvas.width, canvas.height);
    let buffer32 = new Uint32Array(idata.data.buffer);
    for(let i=0; i<buffer32.length; i++) {
        if(Math.random() < 0.15) buffer32[i] = 0xff220000; 
    }
    ctx.putImageData(idata, 0, 0);
    requestAnimationFrame(noise);
}
noise();
