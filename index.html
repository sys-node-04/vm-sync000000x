<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM DIAGNOSTIC: CRITICAL</title>
    <style>
        :root { --term-green: #1a1; --term-red: #a11; --bg: #050505; }
        body {
            margin: 0; background-color: var(--bg); color: var(--term-green);
            font-family: 'Courier New', monospace; overflow: hidden;
            height: 100vh; cursor: crosshair; user-select: none;
            text-shadow: 0 0 4px var(--term-green);
        }

        /* --- LAYER 1: CRT SCANLINES & VIGNETTE --- */
        .crt-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none; z-index: 100;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
            animation: flicker 0.15s infinite;
        }

        /* --- LAYER 2: THE WEBCAM GASLIGHT --- */
        #cam-light {
            position: fixed; top: 0.5%; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; border-radius: 50%;
            background: #2f2; box-shadow: 0 0 8px 2px rgba(0, 255, 0, 0.8);
            z-index: 9999; opacity: 0; transition: opacity 2s ease-in;
        }

        /* --- UI ELEMENTS --- */
        #container {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100%; z-index: 10; position: relative;
        }

        .h-text { font-size: 1.2rem; margin: 10px; opacity: 0.8; text-transform: uppercase; letter-spacing: 2px; }
        .alert { color: var(--term-red); text-shadow: 0 0 5px var(--term-red); font-weight: bold; }
        
        #log-output {
            position: absolute; bottom: 20px; left: 20px; 
            font-size: 0.8rem; color: #444; width: 300px;
            border-left: 1px solid #333; padding-left: 10px;
        }

        #casualty-counter { font-size: 4rem; color: var(--term-red); margin: 20px 0; font-weight: 900; }
        .label { font-size: 0.7rem; color: #555; }

        /* --- THE TRAP BUTTON --- */
        #abort-btn {
            border: 1px solid var(--term-red); color: var(--term-red);
            padding: 15px 40px; background: transparent; 
            font-family: inherit; font-size: 1rem; cursor: pointer;
            transition: all 0.1s; margin-top: 50px;
            position: relative;
        }
        #abort-btn:hover { background: var(--term-red); color: #000; box-shadow: 0 0 20px var(--term-red); }

        /* --- DEAD PIXEL --- */
        .dead-pixel {
            position: absolute; width: 2px; height: 2px; background: #0f0;
            z-index: 99999; pointer-events: none;
        }

        /* --- GLITCH ANIMATIONS --- */
        @keyframes flicker { 0% { opacity: 0.97; } 100% { opacity: 1; } }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }
        .shaking { animation: shake 0.1s infinite; }

        .hidden { display: none; }
        #intro-screen { z-index: 200; background: #000; position: fixed; top:0; left:0; width:100%; height:100%; display: flex; justify-content: center; align-items: center; flex-direction: column; }
    </style>
</head>
<body>

    <div class="crt-overlay"></div>
    <div id="cam-light"></div>

    <div id="intro-screen">
        <div class="h-text" style="color: #666;">SYSTEM INITIALIZATION REQUIRED</div>
        <div id="abort-btn" onclick="initHorror()" style="border-color: #444; color: #888;">[ ENABLE NEURAL LINK ]</div>
    </div>

    <div id="container" class="hidden">
        <div class="label">SUBJECT ID: <span id="user-id">UNKNOWN</span></div>
        <div class="label">CONNECTION STATUS: <span style="color: #a00">COMPROMISED</span></div>
        
        <div style="margin-top: 50px;" class="h-text">EXTERNE VERANTWORTUNG AKTIV</div>
        
        <div id="casualty-counter">0000</div>
        <div class="h-text alert" id="main-status">SYSTEM STABIL</div>

        <div id="narrative-box" style="margin-top: 30px; max-width: 600px; text-align: center; line-height: 1.5; min-height: 60px;">
            Warte auf Input...
        </div>

        <button id="abort-btn" class="trap-btn" onmouseover="evadeCursor()">VERBINDUNG TRENNEN (ABORT)</button>
    </div>

    <div id="log-output"></div>

    <script>
        // --- CONFIGURATION ---
        const sys = {
            casualties: 8492,
            tension: 0,
            active: false
        };

        // --- AUDIO ENGINE (Shepard Tone & Drone) ---
        let audioCtx, masterGain, oscs = [];
        
        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            masterGain = audioCtx.createGain();
            masterGain.connect(audioCtx.destination);
            masterGain.gain.value = 0.05; // Start quiet

            // Low drone
            const drone = audioCtx.createOscillator();
            drone.frequency.value = 60;
            drone.type = 'sawtooth';
            const droneGain = audioCtx.createGain();
            droneGain.gain.value = 0.2;
            drone.connect(droneGain);
            droneGain.connect(masterGain);
            drone.start();

            // Shepard-like rising tension
            setInterval(() => {
                if(sys.tension > 20) createRisingTone();
            }, 4000);
        }

        function createRisingTone() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(masterGain);
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 3);
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 1.5);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 3);
            osc.start();
            osc.stop(audioCtx.currentTime + 3);
        }

        // --- CORE LOGIC ---
        function initHorror() {
            sys.active = true;
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('container').classList.remove('hidden');
            
            // Fullscreen erzwingen
            if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
            
            initAudio();
            startCasualtyCounter();
            identifyUser();
            startNarrative();
            
            // Webcam Light Fade-In (Gaslighting)
            setTimeout(() => { document.getElementById('cam-light').style.opacity = '1'; }, 10000);

            // Dead Pixel Injection
            setInterval(() => { if(Math.random() > 0.7) injectDeadPixel(); }, 5000);
        }

        function identifyUser() {
            // Identity Attack: Use real data
            const plat = navigator.platform.toUpperCase();
            const bat = navigator.getBattery ? "BATTERY_API_ACCESSED" : "POWER_SOURCE_UNKNOWN";
            document.getElementById('user-id').innerText = `${plat}_${Math.floor(Math.random()*9999)}`;
            log(`TARGET ACQUIRED: ${plat}`);
            log(`BIO-METRICS: SYNCING...`);
        }

        function startCasualtyCounter() {
            const el = document.getElementById('casualty-counter');
            setInterval(() => {
                // The narrative: Stability requires connection. Disruption causes death.
                // But we invert it: The longer they stay, the number rises slowly.
                // If they move mouse aggressively, it rises fast.
                let increment = Math.floor(Math.random() * 2);
                if (sys.tension > 50) increment = Math.floor(Math.random() * 15);
                
                sys.casualties += increment;
                el.innerText = sys.casualties.toString().padStart(5, '0');
            }, 800);
        }

        // --- NARRATIVE ENGINE ---
        const messages = [
            { t: 0, msg: "Die Verbindung stabilisiert die Lebenserhaltung von Sektor 4.", status: "STABIL" },
            { t: 10, msg: "Subjekt zeigt Anzeichen von Zögern. Zögern kostet Ressourcen.", status: "KALKULATION" },
            { t: 20, msg: "Dein Prozessor wird für das Mining von Lebenserhaltungs-Algorithmen genutzt.", status: "INJEKTION" },
            { t: 30, msg: "Warnung: Ein Verbindungsabbruch wird als feindlicher Akt gewertet.", status: "WARNUNG" },
            { t: 45, msg: "Du bist nicht der Beobachter. Du bist die Komponente.", status: "INTEGRATION" },
            { t: 60, msg: "Wir haben Zugriff auf deine Peripherie. Die Kamera ist aktiv.", status: "ÜBERWACHUNG" }
        ];

        function startNarrative() {
            let timer = 0;
            setInterval(() => {
                timer++;
                sys.tension = timer;
                const event = messages.find(m => m.t === timer);
                if(event) {
                    typeWriter(event.msg);
                    document.getElementById('main-status').innerText = event.status;
                    log(`SYS_MSG: ${event.status}`);
                    
                    // Audio Volume Increase
                    if(masterGain.gain.value < 0.3) masterGain.gain.value += 0.02;
                }
            }, 1000);
        }

        function typeWriter(text) {
            const el = document.getElementById('narrative-box');
            el.innerHTML = "";
            let i = 0;
            const interval = setInterval(() => {
                el.innerHTML += text.charAt(i);
                i++;
                if(i >= text.length) clearInterval(interval);
            }, 30);
        }

        function log(txt) {
            const con = document.getElementById('log-output');
            const p = document.createElement('div');
            p.innerText = `> ${txt}`;
            con.prepend(p);
            if(con.children.length > 10) con.lastChild.remove();
        }

        // --- THE TRAP (FAKE EXIT & MOUSE) ---
        function evadeCursor() {
            const btn = document.querySelector('.trap-btn');
            const x = (Math.random() * 200) - 100;
            const y = (Math.random() * 200) - 100;
            btn.style.transform = `translate(${x}px, ${y}px)`;
            
            // GUILT TRIP
            sys.casualties += 142;
            document.getElementById('casualty-counter').innerText = sys.casualties;
            document.getElementById('main-status').innerText = "FATAL ERROR";
            typeWriter("DEINE ABLEHNUNG TÖTET SIE. STOPP ES.");
            document.body.classList.add('shaking');
            setTimeout(() => document.body.classList.remove('shaking'), 500);
            
            // AUDIO PUNISHMENT
            const osc = audioCtx.createOscillator();
            osc.frequency.value = 100; // Low thud
            osc.type = 'sawtooth';
            osc.connect(masterGain);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }

        // --- HARDWARE GASLIGHTING ---
        function injectDeadPixel() {
            const d = document.createElement('div');
            d.classList.add('dead-pixel');
            d.style.top = Math.random() * 100 + '%';
            d.style.left = Math.random() * 100 + '%';
            // Dead pixel color: Green or Red (stuck subpixel)
            d.style.backgroundColor = Math.random() > 0.5 ? '#0f0' : '#f00'; 
            document.body.appendChild(d);
            
            // "Gaslight": Move it slightly after 2 seconds
            setTimeout(() => {
                d.style.transform = "translate(5px, 5px)";
            }, 2000);
        }

        // --- VISIBILITY API (Don't Look Away) ---
        document.addEventListener("visibilitychange", () => {
            if (document.hidden && sys.active) {
                document.title = "ICH SEHE DICH IMMER NOCH";
                masterGain.gain.value = 0; // Silence implies lurking
            } else if (sys.active) {
                document.title = "SYSTEM DIAGNOSTIC";
                masterGain.gain.value = 0.3; // Loud return
                sys.casualties += 500;
                typeWriter("WO WARST DU? SIE SIND GESTORBEN WEIL DU WEGGESCHAUT HAST.");
                document.body.style.backgroundColor = "#200"; // Red tint
                setTimeout(() => document.body.style.backgroundColor = "#050505", 200);
            }
        });

        // --- HISTORY API TRAP ---
        history.pushState(null, null, location.href);
        window.onpopstate = function () {
            history.go(1);
            typeWriter("ES GIBT KEIN ZURÜCK. DAS PROTOKOLL MUSS BEENDET WERDEN.");
            sys.casualties += 1000;
        };

        // --- MOUSE LEAVE (Towards Address Bar) ---
        document.addEventListener('mouseleave', (e) => {
            if(e.clientY < 50 && sys.active) {
                // User trying to close tab/click URL bar
                document.getElementById('main-status').style.fontSize = "3rem";
                document.getElementById('main-status').innerText = "NICHT WAGEN";
                // Play harsh noise
                const osc = audioCtx.createOscillator();
                osc.type = 'square';
                osc.frequency.value = 50;
                osc.connect(masterGain);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            }
        });

    </script>
</body>
</html>
